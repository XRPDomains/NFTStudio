<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="UTF-8">
    <meta http-equiv="encoding" content="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lobibox@1.2.7/css/lobibox.css" />
    <link rel="stylesheet" href="https://unpkg.com/paginationjs@2.1.5/dist/pagination.css" />
    <link type="text/css" rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/web3fonts@1.0.0/css/fontawesome.min.css" />
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/web3fonts@1.0.0/css/all.min.css" />
    <link type="text/css" rel="stylesheet" href="/fonts/Poppins/fonts.css" />
    <link type="text/css" rel="stylesheet" href="/lib/jQuery/PluginStack/Wow-js/animate.css" />
    <link type="text/css" rel="stylesheet" href="/css/custom-new.css?v=66" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.js"></script>
    <script src="https://unpkg.com/xrpl@2.7.0/build/xrpl-latest-min.js"></script>
    <script src="https://xumm.app/assets/cdn/xumm-oauth2-pkce.min.js?v=2.4.0"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootbox@5.5.2/bootbox.all.min.js"></script>
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/bootstrap-notify@3.1.3/bootstrap-notify.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/paginationjs@2.1.5/dist/pagination.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@multiavatar/multiavatar/multiavatar.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery-lazy@1.7.11/jquery.lazy.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script type="text/javascript" src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <script type="text/javascript" src="/lib/jQuery/PluginStack/Wow-js/wow.min.js"></script>
    <script type="text/javascript" src="/js/detectmobilebrowsers.js"></script>
    <script type="text/javascript" src="/js/custom.js?v=7"></script>
    <script type="text/javascript" src="/networks-mainnet.js?v=9"></script>
    <link rel="icon" href="/favicon/favicon-96x96.png?v=3" />
    <link rel="shortcut icon" href="/favicon/favicon-96x96.png?v=3" />
    <meta name="description" property="description" content="NFT Studio - Toolkit for XRPL-NFT" />
    <title>NFT Studio - Toolkit for XRPL-NFT</title>
    <style>

        .warp-header {
            position: absolute;
            z-index: 999;
        }

        .warp-banner {
            padding-top: 200px !important;
            background-position: center top;
            background-size: 100%;
        }

        .warp-search {
            margin: 0 auto;
        }

        .warp-result .text-success {
            color: #0c8dc6 !important;
        }

        .btn-search {
            border-color: none !important;
            background-color: #0c8dc6 !important;
        }

        .btn-search:hover {
            border-color: #FFF !important;
        }

        .btn-search:active {
            border-color: #FFF !important;
            background-color: #0c8dc6 !important;
        }

        .btn-connect-wallet:hover {
            background: #0c8dc6;
            border-color: #FFF;
        }

        .warp-result .btn-success {
            background: linear-gradient(to right, #0c8dc6 0%, #52b25c 100%) !important;
            border: none;
        }

        .result-details .btn-success {
            background: linear-gradient(to right, #0c8dc6 0%, #52b25c 100%);
            border: none;
        }

        .btn-outline-success {
            border: 0px !important;
            color: #ffffff !important;
            background: linear-gradient(to right, #0c8dc6 0%, #52b25c 100%);
            background-size: 250% auto;
            padding: 8px 10px;
        }

        .loading {
            color: #0c8dc6 !important;
        }

        .btn-outline-success:hover {
            background-position: right center;
            color: #FFF !important;
        }

        .bootbox .btn-success {
            background-color: #0c8dc6 !important;
            border-color: #0c8dc6 !important;
        }

        .warp-result {
            padding-top: 20px;
            text-align: center;
            margin: 0 auto;
            margin-bottom: 20px;
        }

        .tld {
            display: none;
        }

        .select-chain {
            font-size: 13px;
        }

        .btn-connect-wallet:hover {
            color: #FFF !important;
        }

        .select-chain .dropdown-toggle {
            color: #FFF;
            cursor: pointer;
            border-radius: 5px;
            border: 1px solid #DDD;
            padding: 16px 20px;
            background: rgb(0 0 0 / 10%);
            vertical-align: middle;
        }

        .select-chain .dropdown-menu {
            top: 12px !important;
        }

        .select-chain .dropdown-menu:before {
            content: '';
            display: inline-block;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-bottom: 7px solid #ccc;
            border-bottom-color: rgba(0, 0, 0, 0.2);
            position: absolute;
            top: -7px;
            left: 9px;
        }

        .select-chain .dropdown-menu:after {
            content: '';
            display: inline-block;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid #ffffff;
            position: absolute;
            top: -6px;
            left: 10px;
        }

        .select-chain .list-item {
            display: block;
            padding: 12px;
            border-bottom: 1px solid #DDD;
            cursor: pointer;
            font-size: 13px;
        }

        .select-chain .list-item-active {
            font-weight: bold;
        }

        .select-chain .list-item:last-child {
            border-bottom: none;
        }

        .chain-logo {
            width: 20px;
            margin-right: 10px;
            margin-top: -5px;
        }

        .result-search {
            background-color: rgb(255, 255, 255);
            overflow: hidden;
            border-radius: 6px;
            -webkit-box-align: center;
            align-items: center;
            padding: 30px;
            margin: 0 auto;
        }

        .result-details .alert-info {
            background: #FFF;
        }

        .pricelist {
            max-width: 450px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #DDD;
            border-radius: 5px;
        }

        .pricelist li {
            border-bottom: 1px solid #DDD;
            margin-top: 7px;
        }

        .pricelist li:last-child {
            border-bottom: 0px solid #DDD;
        }

        .preview {
            position: relative;
            background: linear-gradient(45deg, #a061d0, #30d5c2);
            border-radius: 5px;

        }

        .preview .domainhere {
            position: absolute;
            top: 50%;
            left: 50px;
            color: #FFF;
            font-weight: bold;
            font-size: 25px;
            word-wrap: break-word;
        }

        .nftpreview {
            padding: 10px;
            border: 1px solid #DDD;
            border-radius: 5px;
        }

        .nftpreview img {
            width: 100px;
            margin-right: 7px;
        }

        .nftpreview span {
            font-weight: bold
        }


        .result-select {
            padding: 10px;
            margin: 0px auto;
        }

        .domain-item {
            display: inline-block;
            padding: 15px;
            border: 1px solid #DDD;
            border-radius: 10px;
            margin: 7px;
            text-align: center;
            cursor: pointer;
        }

        .result-select .active {
            border: 2px solid #CCC !important;
        }

        .domain-item-name {
            font-weight: bold;
            font-size: 20px;
            display: block;
        }

        .domain-item-status {
            font-weight: bold;
            display: block;
            font-size: 20px;
        }

        .offer-item {
            display: inline-block;
            padding: 10px;
            border: 1px solid #DDD;
            border-radius: 10px;
            margin: 5px;
            cursor: pointer;
        }

        .offer-item  .offer-item-warp{
            display: flex;
            align-items: left;
        }
        .offer-item .offer-item-image{
            margin-right: 5px;
        }

        .offer-item .offer-item-image img{
           width: 70px;
           margin: 5px;
           border-radius: 3px;
        }

        .offer-item .offer-item-info {
            text-align: left;
        }

        .offer-item .offer-item-destination {
            font-size: 11px;
            
        }

        .offer-item .offer-item-type {
            font-size: 11px;
            
        }

        .offer-item .offer-item-tool {
            margin-top: 5px;
            padding: 7px;
            border-top: 1px solid #DDD;
            font-size: 11px;
            
        }

        .warp-mydomains {
            margin-top: 50px;
            margin: 0 auto;
        }

        .mydomains {
            margin: 0 auto;
            border-radius: 6px;
            margin: 0 auto;
            padding: 30px;
            background-color: rgb(255, 255, 255);
        }

        .mydomain-show {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .mydomain-paging {
            margin-top: 30px;
            border-top: 1px solid #DDD;
            padding-top: 10px;

        }

        .mydomain-name {
            font-weight: bold;
            padding: 10px;
            word-break: break-all;
            line-height: 1.2;
            margin-top: 5px;
        }

        .mydomain-item {
            background-color: rgb(255, 255, 255);
            border: 1px solid #ced4da;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }

        .modal-open .modal {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }

        .modal-dialog {
            width: 600px;
            font-size: 14px;
        }

        .modal-custom .modal-dialog {
            width: 380px;
            font-size: 12px;
        }

        .modal-custom-lg .modal-dialog {
            width: 600px;
            font-size: 12px;
        }


        div[data-notify="container"] {
            width: auto;
            margin-left: 30px;
        }

        div[data-notify="container"] {
            width: auto;
            margin-left: 30px;
        }

        .to_reverse {
            margin-bottom: 10px;
            border: 1px solid #DDD;
            padding: 5px;
        }

        .mynft {
            max-height: 500px;
            overflow-y: auto;
            margin: 20px;
            z-index: 99999;
        }

        .mynft::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
            background-color: #DDD;
        }

        .mynft::-webkit-scrollbar {
            width: 0px !important;
            height: 0px !important;
            background-color: #fff;
        }

        .mynft::-webkit-scrollbar-thumb {
            background-color: #000;
            border-radius: 6px;
        }

        .mynft .mynft-item {
            padding-top: 10px;
            padding-bottom: 10px;
            margin-bottom: 5px;
        }

        .mynft-desc {
            font-size: 12px;
        }

        .mynft .line {
            border-bottom: 1px solid #DDD;
        }

        .mynft .mynft-attrs-item {
            display: inline-block;
            padding: 7px;
            border: 1px solid #DDD;
            border-radius: 3px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 11px;
            background: #f5f5f5;
        }

        .mynft-attrs-title {
            margin-bottom: 7px;
        }

        .mynft .mynft-attrs-warpitem-trait-type {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="warp-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="header-left col-md-1 col-sm-1 col-xs-12">
                    <div class="logo">
                        <a href="/"><img src="/logo/logo.png?=10" /></a>
                    </div>
                </div>
                <div class="header-right col-md-11 col-sm-11 col-xs-12 text-right">
                    <div class="menu">
                        <div class="menu-close"><i class="fal fa-times-circle"></i></div>
                        <ul class="nav">
                            <li class="nav-item active"><a href="#">NFTTransfer</a></li>
                            <li class="nav-item"><a data-id="" href="#">NFTMint Machine</a></li>
                            <li class="nav-item"><a data-id="" href="#">NFTPage Builder</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="click-menu">
            <i class="fal fa-bars"></i>
        </div>
    </div>
    <div class="warp-banner text-center banner-page" style="position:relative;">
        <div class="" style="z-index: 99; position: relative;">
            <div class="banner-nofix" style="z-index: 99; position: relative;">
                <div class="container">
                    <div class="" style="margin-bottom: 20px;">
                        <span class="dropdown select-chain" style='display:none;'>
                            <span class="dropdown-toggle" data-toggle="dropdown" href="#"><span
                                    class='selected-chain'>Select Chain</span></span>
                            <ul class="dropdown-menu">
                            </ul>
                        </span>
                        <span class="btn btn-lg btn-custom btn-big btn-connect-wallet"
                            style="cursor:pointer; text-transform:none;">
                            <i class="fas fa-spinner fa-spin" style="display:none;margin-right:5px;"></i> <img
                                style="width:30px; border-radius: 7px; margin-right: 7px; border:1px solid #FFF"
                                src='/walletlogo/xumm-icon.png' />Connect Wallet
                        </span>
                        <input type="hidden" class="currentAddress" />
                    </div>
                </div>
            </div>

            <div class="myouttransfers" style="display:none; margin-bottom: 20px;">
                <div class="container">
                    <div class="mydomains">
                        <div class="myoutcoming"
                            style="margin-bottom: 20px; border: 1px solid #DDD; padding:20px; border-radius: 5px; display: none;">
                            <h5>Outgoing<span style="margin-left: 5px;" class="orders_count">0</span> Item(s)</h5>
                            <div class="domain-outcoming">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="myintransfers" style="display:none; margin-bottom: 20px;">
                <div class="container">
                    <div class="mydomains">
                        <div class="myincoming"
                            style="margin-bottom: 20px; border: 1px solid #DDD; padding:20px; border-radius: 5px; display: none;">
                            <h5>Incoming<span style="margin-left: 5px;" class="orders_count">0</span> Item(s)</h5>
                            <div class="domain-incoming">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="warp-mydomains" style="display:none;">
                <div class="container">
                    <div class="mydomains">
                        <h4 class='strong' style="color: #000; margin-bottom: 15px; padding: 5px;">You have <span
                                class='total-domains'></span> items</h4>
                        <div class='form-group filter well'
                            style='border-radius: 7px; margin-bottom: 10px; padding: 10px; background: #e3e3e3b3; font-size: 11px;'>
                            <div class='form-inline'>
                                <input type='text' style="margin: 5px;" placeholder="Enter keyword"
                                    class='form-control keyword' />
                                <select class="form-control ddl-collection" style="margin: 5px;">
                                    <option value=''>- Collection -</option>
                                </select>
                                <select class="form-control ddl-domain-length" style="margin: 5px; display: none;">
                                    <option value=''>- Length -</option>
                                </select>
                                <select class="form-control ddl-tlds" style="margin: 5px; display: none;">
                                    <option value=''>- Top Level Domain -</option>
                                    <option value='xrp'>.xrp</option>
                                </select>
                                <span style="cursor:pointer; margin: 5px;"
                                    class='btn btn-sm btn-outline-success btn-mydomain-search'>Search</span>
                                <span style="cursor:pointer; margin: 5px;"
                                    class='btn btn-sm btn-outline-success btn-mydomain-refresh'>Refresh</span>
                                <span style="cursor:pointer; margin: 5px;" class='result-count text-right'></span>
                            </div>
                        </div>

                        <div class='loading text-center' style='display:none; color:#CCC; margin-top: 20px;'><i
                                class='fas fa-4x fa-spinner fa-spin'></i></div>
                        <div class='mydomain-show'></div>
                        <div class='mydomain-paging' style="visibility: hidden">
                            <div class='paging'></div>
                        </div>
                        <div class='mydomain-loadmore'><span
                                style="cursor:pointer; padding: 10px 20px; border: 2px solid #DDD; border-radius: 5px; color: #333;"
                                class='btn btn-mydomain-next'>Load more</span></div>
                    </div>
                </div>
            </div>
        </div>
        <div style="margin-bottom: 20px;"></div>
        <img src="/images/square-warning.png" class="img-position img-position-01" alt="" />
        <img src="/images/square-success.png" class="img-position img-position-02 spin-anything" alt="" />
    </div>
    <div class="warp-footer">
        <div class="container text-center">
            <div class="warp-social">
                <a href="https://twitter.com/XRPDomain" target="_blank" class="wow fadeInUp" data-wow-delay="0.3s"><i
                        class="fab fa-twitter"></i></a>
                <a href="https://github.com/XRPDomains" target="_blank" class="wow fadeInUp" data-wow-delay="0.5s"><i
                        class="fab fa-github"></i></a>
            </div>
        </div>
        <div class="warp-copyright text-center">
            Copyright Â© 2023 NFT Studio - Toolkit for XRPL-NFT - A member of <a href='https://xrpdomains.xyz/'
                target="_blank">XRPDomains.xyz</a>
        </div>
    </div>
    <script type="text/javascript">

        var currentNetwork;

        var contractFirst;

        var currentAddress;

        var contractAddress;

        var domainReverse = '';

        var clickenble = true;

        var isConnection = false;

        var connector;

        var balance;

        var owner = '';

        var auth = new XummPkce('556252c8-e88f-452e-b647-99352e38b887');

        var sdk = null;

        var client;

        var minting = false;

        var isMobile = jQuery.browser.mobile;

        var onxrp_des = "rpZqTPC8GvrSvEfFsUuHkmPCg29GdQuXhC";

        var xrpcafe_des = "rpx9JThQ2y37FaGeeJP7PXDUVEXY3PHZSC";

        if (isMobile == true) {
            $('.progressbar').addClass('progressbar-mobile');
        }

        window.addEventListener('load', async () => {

        });

        var uuid = '';// uuidv4();

        var pusher = new Pusher('f730ce75d58b8975fba7', {
            cluster: 'ap1'
        });

        var channel = pusher.subscribe('xrpdomains_pusher');

        $(document).on('click', '.btn-connect-wallet', async () => {
            auth.authorize().then(
                async function (authorized) {
                    await connect(authorized);
                }
            ).catch(e => {
                notify('alert-danger', '<span class="text-danger">' + e.toString() + '</span>');
            });
        });


        auth.on('error', error => {
            console.log('error', error);
            bootbox.alert('There was an error connecting the wallet, please make sure you use the Xumm Wallet. Error code: ' + error.toString() + '');
        });

        auth.on('success', async () => {
            console.log('success');
            auth.state().then(state => {
                if (state.me) {
                    //console.log('success, me', JSON.stringify(state.me));
                    //connect(state);
                }
            });
        });

        auth.on('retrieved', async () => {
            // Redirect, e.g. mobile. Mobile may return to new tab, this
            // must retrieve the state and process it like normally the authorize method
            // would do
            console.log('Results are in, mobile flow, process sign in')

            auth.state().then(state => {
                //console.log(state)
                if (state) {
                    //console.log('retrieved, me:', JSON.stringify(state.me))
                    connect(state);
                }
            })
        });

        const disconnect = async () => {
            logOut();
            location.reload();

        };

        const logOut = async () => {
            if (auth) {
                auth.logout();
                client.disconnect();
            }

            try {
                doAjax('/api/auth/logOut', '', 'GET');
            } catch (e) { }
        };

        const connect = async (authorized) => {

            if ($('.btn-connect-wallet:visible').length == 0) {
                return;
            }
            if (isConnection == true) {
                return;
            }

            $('.not-support').hide();

            $('.btn-connect-wallet i.fa-spin').show();

            $('.btn-connect-wallet').attr('disabled', true);

            var chainId = 0;

            var text = '';

            currentNetwork = getObjects(networks, "chainId", chainId)[0];

            if (currentNetwork == null || currentNetwork.visible == false) {
                notify('alert-danger', '<span class="text-danger">The network is not currently supported</span>');
                logOut();
                return;
            }

            var networkType = authorized.me.networkType;

            if (networkType !== currentNetwork.networkType) {
                notify('alert-danger', '<span class="text-danger">The network is not currently supported, choose the right network: ' + currentNetwork.networkType + '</span>');
                logOut();
                return;
            }

            try {

                currentAddress = authorized.me.sub;

                sdk = authorized.sdk;

                //SignIn
                var _sign = new Object();

                _sign.owner = currentAddress;

                await doAjax('/api/auth/signIn', JSON.stringify(_sign), 'POST');

                notify('alert-success', 'Successfully connected your wallet');

                $('.not-support').hide();

                client = new xrpl.Client(currentNetwork.rpcUrls[0]);

                await client.connect();

                await showAccount();

                await getDomainTransfers();

                await preInit();

                $('.warp-form-search').show();

                isConnection = true;

            } catch (err) {
                notify('alert-danger', '<span class="text-danger">' + err.toString() + '</span>');

                $('.btn-connect-wallet i.fa-spin').hide();

                $('.btn-connect-wallet').removeAttr('disabled');
            }
        };

        const showAccount = async () => {
            if (currentAddress == '') {
                return;
            }

            domainReverse = '';

            try {
                var _balance = (await client.getXrpBalance(currentAddress));
                balance = parseFloat(_balance).toFixed(3);
            } catch (err) {
                var error = err.toString();
                if (error.indexOf('Account not found') > 0) {
                    bootbox.alert('alert-danger', '<span class="text-danger">Account not found or not activated</span>');
                    $('.btn-connect-wallet i.fa-spin').hide();
                    return;
                }
            }

            // check reverseOf
            try {
                var objDomain = await doAjax('/api/xrplnft/getName?address=' + currentAddress, '', 'GET');
                domainReverse = objDomain.data;
            } catch { }


            text = domainReverse;

            if (domainReverse == '') {
                text = shortAddress(currentAddress);
            }

            text += ' (' + balance + ' ' + currentNetwork.nativeCurrency.symbol + ')';

            text += " <i class='fas fa-copy btn-copy' title='Copy address to clipboard' style='cursor:pointer; margin-left:7px;'></i>";
            text += " <i class='fas fa-sign-out btn-disconnect' title='Disconnect' style='cursor:pointer; margin-left:7px;'></i>";
            $('.btn-connect-wallet').html(text).addClass('wallet-connected').prop('disabled', true).css('cursor', 'default');
            $('.btn-connect-wallet  i.fa-spin').hide();
        }

        const transferComfirm = async (obj) => {
            var domain = obj.domain;
            var tokenId = obj.tokenId;
            var to = obj.to;
            var from = obj.from;
            var dialog = bootbox.dialog({
                title: 'Create transfer offer: ' + domain,
                message: '<p class="text-center">Create sell offer for <strong>' + domain + '</strong> destination <strong>' + to + '</strong><br/>Please wait while we do something... and do not close the browser.<br/><br/> <i class="fas fa-4x fa-spinner fa-spin"></i></p>',
                closeButton: true,
                className: 'modal-custom',
                size: 'large',
                onHide: function (e) {
                    $('.btn-transfer-comfirm i').hide();
                    $('.btn-transfer-comfirm').attr('disabled', false);
                }
            });

            var days = 10;
            let d = new Date();
            d.setDate(d.getDate() + parseInt(days));
            var expirationDate = xrpl.isoTimeToRippleTime(d);
            var domain_memo = xrpl.convertStringToHex(domain);
            var expiration_memo = xrpl.convertStringToHex('Expiration: ' + d.toDateString());
            var eeceiver_memo = xrpl.convertStringToHex('Receiver: ' + to);

            const createOffer_payload = {
                "TransactionType": "NFTokenCreateOffer",
                "Account": currentAddress,
                "NFTokenID": tokenId,
                "Amount": xrpl.xrpToDrops("0"),
                "Flags": parseInt(1),
                "Expiration": expirationDate,
                "Destination": to
            }

            sdk.payload.createAndSubscribe(createOffer_payload, function (payloadEvent) {
                if (typeof payloadEvent.data.signed !== 'undefined') {
                    return payloadEvent.data
                }
            }).then(function ({ created, resolved }) {
                resolved.then(async function (payloadOutcome) {
                    if (payloadOutcome.signed) {
                        var explorer = '<br/><a target="_black" href="' + currentNetwork.blockExplorerUrls[0] + 'transactions/' + payloadOutcome.txid + '">View Transaction</a>';

                        dialog.find('.bootbox-body').html('<p class="text-center" style="color:green;">Create transfer offer successful! Please notify ' + to + ' and ask them to accept<br/>' + explorer + '</p>');

                        getDomainTransfers();
                    } else {
                        dialog.find('.bootbox-body').html('<p class="text-center mb-0" style="color:red;">Transaction failed</p>');
                    }
                })
            })
                .catch(function (payloadError) {
                    dialog.find('.bootbox-body').html('<p class="text-center mb-0" style="color:red;">Transaction failed, ' + payloadError.message + '</p>');
                })
        }

        var dialog;

        const transferForm = (obj) => {
            var domain = obj.domain;
            var tokenId = obj.tokenId;
            var image = obj.image;
            var temp = '<div class="warp-setavatar text-center">';
            temp += '<div class="sendform text-left">';
            temp += "<div class='form-group nftpreview'><img src='" + image + "' /><span class='strong'>" + domain + "</span></div>";
            temp += "<div class='form-group'><label>From: </label><input type='text' class='form-control from_address' value='" + currentAddress + "' disabled /></div>";
            temp += "<div class='form-group'><label>To (Recipient): </label><input type='text' placeholder='Enter wallet address or .XRP Domain name' class='form-control to_address' value='' /><input type='hidden' class='to_hidden_address' /></div><div class='to_reverse' style='display:none;clear:both;'></div>";
            temp += "<div class='form-group text-center' style='margin-top: 10px;'><button class='btn btn-success btn-transfer-comfirm' style='margin: 5px;' disabled><i class='fas fa-spinner fa-spin' style='display:none;'></i>Transfer Now</button><button style='margin: 5px;' class='btn btn-success btn-transfer-cancel btn-close' aria-label='Cancel'>Cancel</button></div>";
            temp += '</div>';
            temp += "<input type='hidden' class='hiddenTransfers' value='" + JSON.stringify(obj) + "' />";
            var dialog = bootbox.dialog({
                title: 'Transfer: ' + domain,
                message: '<div class="text-center">' + temp + '</div>',
                closeButton: true,
                size: 'extra-large',
                onEscape: true,
                onHide: function (e) {
                    myDomains(currentAddress);
                }
            });
        }

        const getDomainTransfers = async () => {

            $('.myouttransfers').hide();

            $('.myintransfers').hide();

            //outgoing domains

            $('.domain-outcoming').html('');

            var url = 'api/xrplnft/getOfferByOwner?network=' + currentNetwork.networkType + '&owner=' + currentAddress;

            var result = await doAjax(url, '', 'GET');

            var offers_out = result.data;

            var count_out = 0;

            $.each(offers_out, async function (i, item) {
                var nftoken_id = item.NFTokenID;
                var offer_id = item.OfferID;
                var owner = item.Owner;
                var destination = item.Destination;
                var temp = '';
                var domain = '';

                var obj = await doAjax('/api/xrplnft/getNFTsbyNFTokenId?nftoken_id=' + nftoken_id, '&network=' + currentNetwork.networkType, 'GET');
                if (obj.data.Issuer !== 'rYhfynZDrde1uSvvQAYctApg6DnVE5HKm') {
                    var uri = fixURI(obj.data.URI, obj.data.NFTokenID);

                    var _obj = new Object();
                    _obj.uri = uri;
                    _obj.owner = obj.data.Owner;
                    _obj.issuer = obj.data.Issuer;
                    _obj.tokenId = obj.data.NFTokenID;

                    var objNFTInfo = await getNFTInfo(_obj);

                    if (objNFTInfo.image !== '') {
                        image = "<img  class='domain-link' data-obj='" + JSON.stringify(objNFTInfo) + "'' src='" + objNFTInfo.image + "' />";
                    }

                    var chkName = true;
                    var offer_type = 'Transfer';
                    if (destination == onxrp_des){
                        offer_type = 'Sell offer from onxrp.com';
                        chkName = false;
                    }
                    if (destination == xrpcafe_des){
                        offer_type = 'Sell offer from xrp.cafe';
                        chkName = false;
                    }

                    var primaryname = destination;

                   // if (chkName == true){
                    //    try {
                    //        var objPrimaryName = await doAjax('/api/xrplnft/getName?address=' + destination, '', 'GET');
                    //        if (objPrimaryName.data !== ''){
                    //            primaryname = objPrimaryName.data;
                    //        }
                    //    } catch (e) {
                    //    }
                    //}
                  
                    var destination_link = "<a target='_blank' href='https://livenet.xrpl.org/accounts/" + destination + "'>" + primaryname + "</a>";

                    temp = '<div class="offer-item">';
                    temp += ' <div class="offer-item-warp">';
                    temp += '   <div class="offer-item-image">' + image + '</div>';
                    temp += '   <div class="offer-item-info">';
                    temp += '       <div class="offer-item-name"><strong>' + objNFTInfo.name + '</strong></div>';
                    temp += '       <div class="offer-item-destination">To: ' + destination_link + '</div>';
                    temp += '       <div class="offer-item-type">Type: ' + offer_type + '</div>';
                    temp += '   </div>';
                    temp += '   </div>';
                    temp += '   <div class="offer-item-tool"><span data-domain="' + objNFTInfo.name + '" data-offer-id="' + offer_id + '" class="btn btn-sm btn-outline-primary btn-cancel-comfirm">Cancel</span></div>';
                    temp += '</div>';

                    $('.myouttransfers').show();

                    $('.myoutcoming').show();

                    $('.domain-outcoming').append(temp);

                    count_out++;
                    $('.myoutcoming .orders_count').text('' + count_out + '');
                }

            });

            // incoming domains
            $('.domain-incoming').html('');

            var url = 'api/xrplnft/getOfferByDestination?issuer=' + currentNetwork.contractAddress + '&network=' + currentNetwork.networkType + '&owner=' + currentAddress;
            var result = await doAjax(url, '', 'GET');
            var offers_in = result.data;
            var count_in = 0;

            $.each(offers_in, async function (i, item) {

                var nftoken_id = item.NFTokenID;
                var offer_id = item.OfferID;
                var owner = item.Owner;
                var temp = '';
                var domain = '';

                var obj = await doAjax('/api/xrplnft/getNFTsbyNFTokenId?nftoken_id=' + nftoken_id, '&network=' + currentNetwork.networkType, 'GET');

                if (obj.data.Issuer !== 'rYhfynZDrde1uSvvQAYctApg6DnVE5HKm') {

                    var uri = fixURI(obj.data.URI, obj.data.NFTokenID);

                    var _obj = new Object();
                    _obj.uri = uri;
                    _obj.owner = obj.data.Owner;
                    _obj.issuer = obj.data.Issuer;
                    _obj.tokenId = obj.data.NFTokenID;

                    var objNFTInfo = await getNFTInfo(_obj);

                    var image = '';

                    if (objNFTInfo.image !== '') {
                        image = "<img  class='domain-link' data-obj='" + JSON.stringify(objNFTInfo) + "'' src='" + objNFTInfo.image + "' />";
                    }

                    var offer_type = 'Transfer';

                    var primaryname = owner;
                    
                    //try {
                   //     var objPrimaryName = await doAjax('/api/xrplnft/getName?address=' + owner, '', 'GET');
                    //    if (objPrimaryName.data !== ''){
                   //         primaryname = objPrimaryName.data;
                    //    }
                    //} catch (e) {
                    //}
                  
                    var owner_link = "<a target='_blank' href='https://livenet.xrpl.org/accounts/" + owner + "'>" + primaryname + "</a>";
                
                    temp = '<div class="offer-item">';
                    temp += ' <div class="offer-item-warp">';
                    temp += '   <div class="offer-item-image">' + image + '</div>';
                    temp += '   <div class="offer-item-info">';
                    temp += '       <div class="offer-item-name"><strong>' + objNFTInfo.name + '</strong></div>';
                    temp += '       <div class="offer-item-destination">From: ' + owner_link + '</div>';
                    temp += '       <div class="offer-item-type">Type: ' + offer_type + '</div>';
                    temp += '   </div>';
                    temp += '   </div>';
                    temp += '   <div class="offer-item-tool"><span data-domain="' + objNFTInfo.name + '" data-offer-id="' + offer_id + '" style="font-size:11px; margin-top: 5px;" class="btn btn-sm btn-outline-primary btn-accept-comfirm">Accept</span></div>';
                    temp += '</div>';

                    $('.myintransfers').show();

                    $('.myincoming').show();

                    $('.domain-incoming').append(temp);
                    count_in++;
                    $('.myincoming .orders_count').text('' + count_in + '');
                }

            });

            if (offers_out.length == 0) {
                $('.myouttransfers').hide();
            }

            if (offers_in.length == 0) {
                $('.myintransfers').hide();
            }

        };

        const acceptOffer = async (domain, offer_id) => {
            var dialog = bootbox.dialog({
                title: 'Accept offer: ' + domain,
                message: '<p class="text-center">Please wait while we do something... and do not close the browser.<br/><br/> <i class="fas fa-4x fa-spinner fa-spin"></i></p>',
                closeButton: true,
                size: 'large',
                onHide: function (e) {
                    myDomains(currentAddress, '');
                    getDomainTransfers();
                }
            });

            var MemoData = xrpl.convertStringToHex(domain);

            const accept_payload = {
                "TransactionType": "NFTokenAcceptOffer",
                "Account": currentAddress,
                "NFTokenSellOffer": offer_id,
                "Memos": [
                    {
                        "Memo": {
                            "MemoData": MemoData
                        }
                    }
                ]
            }

            sdk.payload.createAndSubscribe(accept_payload, function (payloadEvent) {
                if (typeof payloadEvent.data.signed !== 'undefined') {
                    return payloadEvent.data
                }
            })
                .then(function ({ created, resolved }) {

                    var payload_uuid = created.uuid;
                    var objIntervalDb;
                    var tx = '';
                    var status = '';
                    if (isMobile == true) {
                        try {
                            objIntervalDb = setInterval(async () => {
                                if (tx !== null && tx !== '' && status !== '') {
                                    clearInterval(objIntervalDb);
                                    $('.progressbar .step-payment .step-status').html('<span class="text-center" style=""><i class="fas fa-spinner fa-spin" style="margin-right:5px;"></i>Xumm Wallet: Accepted & Checking</span>');
                                    if (status == 'tesSUCCESS') {
                                        var objAcceptOffered = new Object();
                                        objAcceptOffered.domain = domain;
                                        objAcceptOffered.owner = currentAddress;
                                        objAcceptOffered.accept_offer_tx = tx;

                                        var acceptOfferedOrderUrl = '/api/xrplnft/acceptOfferedOrder';

                                        doAjax(acceptOfferedOrderUrl, JSON.stringify(objAcceptOffered), 'POST');

                                        var explorer_transfer = '<br/><a target="_black" href="' + currentNetwork.blockExplorerUrls[0] + 'transactions/' + tx + '">View Transaction</a>';

                                        dialog.find('.bootbox-body').html('<p class="text-center"><span class="text-center mb-0" style="color:green;">Transfer ' + domain + ': Done</span>' + explorer_transfer + '</p>');
                                    }
                                    else {
                                        dialog.find('.bootbox-body').html('<p class="text-center"><span class="text-center mb-0" style="color:green;">Transfer ' + domain + ': Rejected</span></p>');
                                    }
                                }
                                else {
                                    var result = await sdk.payload.get(payload_uuid);
                                    if (result) {
                                        status = result.response.dispatched_result;
                                        tx = result.response.txid;
                                    }
                                }
                            }, 4000);

                        } catch (e) {
                            bootbox.alert('There was a transaction error, please refresh your browser and check the domain name under "Orders Pending"');
                        }
                    }

                    resolved.then(async function (payloadOutcome) {
                        if (isMobile == false) {
                            if (payloadOutcome.signed) {
                                var objAcceptOffered = new Object();
                                objAcceptOffered.domain = domain;
                                objAcceptOffered.owner = currentAddress;
                                objAcceptOffered.accept_offer_tx = payloadOutcome.txid;

                                var acceptOfferedOrderUrl = '/api/xrplnft/acceptOfferedOrder';

                                var acceptOfferedOrder = await doAjax(acceptOfferedOrderUrl, JSON.stringify(objAcceptOffered), 'POST');

                                var explorer_transfer = '<br/><a target="_black" href="' + currentNetwork.blockExplorerUrls[0] + 'transactions/' + payloadOutcome.txid + '">View Transaction</a>';

                                dialog.find('.bootbox-body').html('<p class="text-center"><span class="text-center mb-0" style="color:green;">Transfer ' + domain + ': Done</span>' + explorer_transfer + '</p>');

                            } else {
                                dialog.find('.bootbox-body').html('<p class="text-center"><span class="text-center mb-0" style="color:red;">Transfer ' + domain + ': Rejected</span></p>');
                            }
                        }
                    })
                })
                .catch(function (payloadError) {
                    //$('.progressbar .step-payment .step-status').html('<span class="text-center" style="color:red;">Xumm Wallet: ' + payloadError + '</span>');
                });
        }

        const cancelOffer = async (domain, offer_id) => {
            var dialog = bootbox.dialog({
                title: 'Cancel offer: ' + domain,
                message: '<p class="text-center">Please wait while we do something... and do not close the browser.<br/><br/> <i class="fas fa-4x fa-spinner fa-spin"></i></p>',
                closeButton: true,
                size: 'large',
                onHide: function (e) {
                    myDomains(currentAddress, '');
                    getDomainTransfers();
                }
            });

            var MemoData = xrpl.convertStringToHex(domain);

            const tokenOfferIDs = [offer_id];

            const cancel_payload = {
                "TransactionType": "NFTokenCancelOffer",
                "Account": currentAddress,
                "NFTokenOffers": tokenOfferIDs
            }

            sdk.payload.createAndSubscribe(cancel_payload, function (payloadEvent) {
                if (typeof payloadEvent.data.signed !== 'undefined') {
                    // What we return here will be the resolved value of the `resolved` property
                    return payloadEvent.data
                }
            })
                .then(function ({ created, resolved }) {

                    resolved.then(async function (payloadOutcome) {
                        if (payloadOutcome.signed) {
                            var explorer_cancel = '<br/><a target="_black" href="' + currentNetwork.blockExplorerUrls[0] + 'transactions/' + payloadOutcome.txid + '">View Transaction</a>';

                            dialog.find('.bootbox-body').html('<p class="text-center"><span class="text-center mb-0" style="color:green;">Cancel offer ' + domain + ': Done</span>' + explorer_cancel + '</p>');

                        } else {
                            dialog.find('.bootbox-body').html('<p class="text-center"><span class="text-center mb-0" style="color:red;">Cancel offer ' + domain + ': Rejected</span></p>');
                        }
                    })
                })
                .catch(function (payloadError) {
                    //$('.progressbar .step-payment .step-status').html('<span class="text-center" style="color:red;">Xumm Wallet: ' + payloadError + '</span>');
                });
        }

        var dataSource = [];

        var balance = 0;

        const myDomainLoad = async (address, data) => {
            if (data.length > 0) {

                $('.loading').hide();

                $('.warp-mydomains').show();

                const d = new Date();

                var t = d.getTime();

                $.each(data, async function (index, obj) {

                    var objNFTInfo = await getNFTInfo(obj);

                    obj.domain = objNFTInfo.name;
                    obj.name = objNFTInfo.name;
                    obj.image = objNFTInfo.image;

                    var temp = "<div class='mydomain-item'>";
                    temp += "<div class=''><div class='domain-link' data-obj='" + JSON.stringify(objNFTInfo) + "' data-domain='" + obj.name + "' style='text-decoration: none; cursor: pointer;'><img class='domain-image lazy' data-src='" + obj.image + "' src='/images/spinner.gif?v=3' data-domain='" + obj.name + "' style='width: 100%;' /></div><p class='domain-name' data-domain='" + obj.name + "' style='margin-top: 10px;'>" + obj.name + "</p></div>";
                    //temp += "<a target='_blank' style='text-decoration: none;' class='btn btn-sm btn-outline-success' href='" + objNFTInfo.explorer + "'>View NFToken</a>";
                    temp += "<div style='cursor:pointer; margin-top: 0px;' data-obj='" + JSON.stringify(obj) + "' class='btn btn-sm btn-outline-success btn-send'>Transfer</div>";

                    temp += "</div>";

                    $('.mydomain-show').append(temp);
                });

                setTimeout(function () {
                    $('.lazy').Lazy({
                        scrollDirection: 'both',
                        effect: 'fadeIn',
                        visibleOnly: true,
                        removeAttribute: true
                    });
                }, 1000);
            }
        };


        const myDomains = async (address, refresh) => {

            $('.warp-mydomains').show();

            $('.mydomain-show').html('');

            $('.result-count').html('');

            $('.loading').show();

            if (refresh == true) {
                dataSource = [];
                dataSourceNew = [];
                isSearch = false;
                $('.keyword').val('');
                $('.ddl-collection').val('');
                $('.mydomain-show').html('');
                $('.total-domains').html('');
            }

            //getOfferByDestination();

            var argIssuer = [];

            if (dataSource.length == 0) {
                const _results = await client.request({
                    method: "account_nfts",
                    account: currentAddress,
                    limit: 399
                });

                var nfts = _results.result.account_nfts;

                var i = 1;

                $.each(nfts, function (i, item) {

                    if (item.Issuer !== 'rYhfynZDrde1uSvvQAYctApg6DnVE5HKm') {
                        var issuer = item.Issuer;

                        var NFTokenID = item.NFTokenID;

                        var uri = fixURI(item.URI, item.NFTokenID);

                        var obj = new Object();
                        obj.issuer = issuer;
                        obj.owner = currentAddress;
                        obj.tokenId = NFTokenID;
                        obj.issuer = issuer;
                        obj.name = "";
                        obj.image = '';
                        obj.uri = uri;

                        dataSource.push(obj);
                        i++;

                        const foundIssuer = argIssuer.find(el => el.issuer == issuer);

                        if (typeof foundIssuer == 'undefined') {
                            var objIssuer = new Object();
                            objIssuer.issuer = issuer;
                            objIssuer.avatar = '';
                            objIssuer.balance = 1;
                            objIssuer.uri = uri;
                            objIssuer.name = '';
                            argIssuer.push(objIssuer);
                        }
                        else {
                            foundIssuer.balance += 1;
                        }
                    }


                });
            }

            $.each(argIssuer, async function (i, obj) {
                var option = '<option value="' + obj.issuer + '">' + obj.issuer + '</option>';
                $('.ddl-collection').append(option);
            });

            var dataSourceNew = dataSource;

            var keyword = $('.keyword').val().trim().toLowerCase();

            var collection = $('.ddl-collection').val();

            balance = dataSourceNew.length;

            $('.total-domains').html(balance);

            $('.result-count').html(balance + ' results');

            var pageSize = 20;

            var totalNumber = dataSourceNew.length;

            var container = $('.paging');

            if (totalNumber > 0) {
                container.pagination({
                    dataSource: dataSourceNew,
                    totalNumber: totalNumber,
                    pageSize: pageSize,
                    showPrevious: true,
                    showNext: true,
                    className: 'paginationjs-pages justify-content-center',
                    showGoInput: true,
                    showGoButton: true,
                    callback: function (data, pagination) {
                        myDomainLoad(address, data);
                    }
                });

            }
            else {

                $('.loading').hide();

                $('.warp-mydomains').show();

                $('.mydomain-show').html('<p class="text-center">No items found for this search</p>');
            }

            $(document).on('scroll', onScroll);

            function onScroll(event) {
                try {
                    var next = $('.btn-mydomain-next');
                    var scrollPos = $(document).scrollTop() + 300;
                    var position = next.position().top - 300;
                    if (position <= scrollPos) {
                        container.pagination('next');
                    }
                } catch { }

            }
        };

        const myNFT = (obj) => {

            var tmp = '';

            tmp = "<div class='mynft-image mynft-item'><a target='_blank' href='" + obj.image + "'><img src='" + obj.image + "' /></a></div>";
            //tmp += "<div class='mynft-name mynft-item line'><h3>" + obj.name + "</h3></div>";
            tmp += "<div class='mynft-owner mynft-item line'>Issuer: <a href='#' target='_blank'>" + obj.issuer + "</a></div>";
            tmp += "<div class='mynft-owner mynft-item line'>Owner: <a href='#' target='_blank'>" + obj.owner + "</a></div>";
            tmp += "<div class='mynft-tx mynft-item line'>Transaction: <a href='" + obj.explorer + "' target='_blank'>View Details</a></div>";
            tmp += "<div class='mynft-desc mynft-item line'>" + obj.description + "</div>";
            tmp += "<div class='mynft-attrs mynft-item line'>";
            var _tmp = '';
            if (obj.attributes.length > 0) {
                $.each(obj.attributes, function (i, item) {
                    var value = item.value;
                    if (value == '') {
                        value = '.';
                    }
                    _tmp += "<div class='mynft-attrs-item'>";
                    _tmp += "    <div class='mynft-attrs-warpitem-trait-type'>" + item.trait_type + "</div>";
                    _tmp += "    <div class='mynft-attrs-warpitem-trait-value'>" + value + "</div>";
                    _tmp += "</div>";
                });
            }


            tmp += "<div class='mynft-attrs-title'>Attributes</div>";
            tmp += "<div class='mynft-attrs-warp'>" + _tmp + "</div>";
            tmp += "</div>";

            var dialog = bootbox.dialog({
                title: obj.name,
                message: '<div class="mynft">' + tmp + '</div>',
                closeButton: true,
                size: 'large',
                onHide: function (e) {

                }
            });
        }

        var cacheNFTs = [];

        const getNFTInfo = async function (item) {
            var obj = cacheNFTs.find(el => el.uri === item.uri);

            if (typeof obj !== 'undefined') {
                return obj;
            }

            try{
                obj = await doAjax(item.uri);
            }catch{}
           
            if (typeof obj !== "undefined") {
                var image = obj.image;

                if (typeof image == 'undefined') {
                    image = obj.image_url;
                }
                if (typeof image !== 'undefined') {
                    image = fixImageUrl(image);
                    obj.image = image;
                }

                obj.owner = item.owner;
                obj.explorer = currentNetwork.blockExplorerUrls[0] + 'nft/' + item.tokenId;
                obj.tokenId = item.tokenId;
                obj.issuer = item.issuer;
                cacheNFTs.push(obj);
                return obj;
            }
            else {
                var _obj = new Object();
                _obj.symbol = '';
                _obj.description = '';
                _obj.external_url = '';
                _obj.domain = 'No name';
                _obj.name = 'No name';
                _obj.tokenId = item.tokenId;
                _obj.image = '/images/default.png';
                _obj.attributes = [];
                _obj.owner = item.owner;
                _obj.explorer = currentNetwork.blockExplorerUrls[0] + 'nft/' + item.tokenId;
                _obj.tokenId = item.tokenId;
                _obj.issuer = item.issuer;
                cacheNFTs.push(_obj);
                return _obj;
            }
        };

        const preInit = async () => {

            $(document).on('click', '.btn-copy', () => {
                copyToClipboard(currentAddress);
                $('.btn-copy').removeClass('fa-copy').addClass('fa-check-circle');

                setTimeout(function () {
                    $('.btn-copy').removeClass('fa-check-circle').addClass('fa-copy');
                }, 500);
            });

            $(document).on('click', '.btn-disconnect', () => {
                disconnect();
            });

            $(document).on('click', '.btn-mydomain-refresh', async function (e) {
                await myDomains(currentAddress, true);
            });

            $(document).on('click', '.btn-mydomain-search', async function (e) {
                await myDomains(currentAddress, false);
            });

            $(document).on('click', '.domain-link', async function (e) {

                var str = $(this).attr('data-obj');
                if (str == '') {
                    return;
                }
                var obj = JSON.parse(str);

                if (obj == null) {
                    return;
                }

                await myNFT(obj);
            });


            $(document).on('click', '.btn-accept-comfirm', async function (e) {
                var domain = $(this).attr('data-domain');
                var offer_id = $(this).attr('data-offer-id');
                await acceptOffer(domain, offer_id);
            });

            $(document).on('click', '.btn-cancel-comfirm', async function (e) {
                var domain = $(this).attr('data-domain');
                var offer_id = $(this).attr('data-offer-id');
                await cancelOffer(domain, offer_id);
            });

            $(document).on('click', '.btn-send', async function () {
                var str = $(this).attr('data-obj');
                if (str == '') {
                    return;
                }
                var obj = JSON.parse(str);
                if (obj == null) {
                    return;
                }
                transferForm(obj);
            });

            $(document).on('click', '.btn-transfer-cancel', async function () {
                bootbox.hideAll();
            });

            $(document).on('click', '.btn-transfer-comfirm', async function () {
                var str = $('.hiddenTransfers').val();
                var toAddress = $('.to_hidden_address').val();

                if (str == '' || toAddress == '') {
                    alert('Please enter to address');
                    return;
                }

                var isAddress = xrpl.isValidAddress(toAddress);

                if (isAddress == false) {
                    alert('wallet address not in xrp format');
                    return;
                }

                if (toAddress == currentAddress) {
                    alert('The sending address must be different from the receiving address');
                    return;
                }

                var obj = JSON.parse(str);
                if (obj == null) {
                    return;
                }
                obj.to = toAddress;

                $('.btn-transfer-comfirm i').show();

                $('.btn-transfer-comfirm').attr('disabled', true);

                transferComfirm(obj);
            });

            $(document).on('change', '.to_address', async function () {
                var to = $(this).val().trim();
                if (to == '') {
                    return;
                }

                $('.to_hidden_address').val('');

                $('.btn-transfer-comfirm').attr('disabled', true);

                var isAddress = xrpl.isValidAddress(to);

                if (isAddress == true) {
                    $('.to_hidden_address').val(to);
                    try {
                        var owner = to;
                        var domain = 'XRP Wallet Address';
                        try {
                            var objDomain = await doAjax('/api/xrplnft/getName?address=' + owner, '', 'GET');
                            if (objDomain.data!==''){
                                domain = objDomain.data;
                            }
                        } catch (e) {
                        }
                        var ethavatar = "<div class='ethavatar' style='width: 35px; float:left; margin: 5px;'>" + multiavatar(owner) + "</div>";
                        var ownerinfo = "<div class='ownerinfo'><div class='strong' style='color: green;'>" + domain + "</div><div class='small'>" + owner + "</div></div>";
                        var lblowner = ethavatar + ownerinfo;
                        $('.to_reverse').html(lblowner).show();
                    } catch {
                        $('.to_reverse').html(lblowner).hide();
                    }
                }

                if (isAddress == false) {
                    var domain = to;
                    var owner = '';
                    try {
                        var url = 'api/xrplnft/getAddress?domain=' + domain;
                        var result = await doAjax(url, '', 'GET');
                        owner = result.data.owner;
                    } catch (e) {
                    }
                    if (owner !== '') {
                        $('.to_hidden_address').val(owner);
                        var ethavatar = "<div class='ethavatar' style='width: 35px; float:left; margin: 5px;'>" + multiavatar(domain) + "</div>";
                        var ownerinfo = "<div class='ownerinfo'><div class='strong' style='color: green;'>" + domain + "</div><div class='small'>" + owner + "</div></div>";
                        var lblowner = ethavatar + ownerinfo;
                        $('.to_reverse').html(lblowner).show();
                    }
                    else {
                        $('.to_hidden_address').val('');
                        $('.to_reverse').html('').hide();
                    }
                }

                $('.btn-transfer-comfirm').attr('disabled', false);
            });

            await myDomains(currentAddress, true);
        };



        const notify = function (type, msg) {
            $.notify({
                message: '<span class="small">' + msg + '</span>',
                type: type
            }, {
                delay: 7000, placement: {

                    from: "bottom",
                    align: "center"
                }
            });
        };

        var URI = function (href) {
            var l = document.createElement("a");
            l.href = href;
            return l;
        };

        const doAjax = async (url, args, method) => {
            let result;
            try {
                result = await $.ajax({
                    url: url,
                    type: method,
                    data: args
                });

                return result;
            } catch (error) {
            }
        }


        function fixURI(URI, NFTokenID) {
            var uri = '';
            if (typeof URI !== 'undefined') {
                uri = xrpl.convertHexToString(URI);
                if (checkUrl(uri) == false) {
                    uri = 'https://ipfs.io/ipfs/' + uri.replace('ipfs://', '');
                }
                if (uri.indexOf('ipfs://') == 0) {
                    uri = 'https://ipfs.io/ipfs/' + uri.replace('ipfs://', '');
                }
            } else {
                uri = 'https://marketplace-api.onxrp.com/api/metadata/' + NFTokenID;
            }
            return uri;
        }

        function fixImageUrl(image) {
            if (typeof image == 'undefined') {
                return "";
            }
            if (image.indexOf('ipfs/') >= 0) {
                image.replace('ipfs/', '');
            }

            if (image.indexOf('ipfs://') >= 0 || checkUrl(image) == false) {
                image = 'https://ipfs.io/ipfs/' + image.replace('ipfs://', '').replace('ipfs/', '');
            };
            return image;
        }

        function copyToClipboard(text) {
            var $temp = $("<input>");
            $("body").append($temp);
            $temp.val(text).select();
            document.execCommand("copy");
            $temp.remove();
        }

        function checkUrl(url) {
            let givenURL;
            try {
                givenURL = new URL(url);
            } catch (error) {
                console.log("error is", error);
                return false;
            }
            return true;
        }

        const shortAddress = (address) => {
            var text = '';
            for (let i = 0; i < 5; i++) {
                text += address[i];
            }

            text += '...'

            for (let i = address.length - 4; i < address.length; i++) {
                text += address[i];
            }

            return text;
        }

        function uuidv4() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        };
    </script>
</body>

</html>